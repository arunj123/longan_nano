# --- openocd-sipeed-libusb.cfg (Definitive Version) ---

# --- Interface & Reset Configuration ---
adapter driver ftdi
adapter speed 10000
ftdi vid_pid 0x0403 0x6010

# Use the correct hardware reset configuration with MODERN syntax
reset_config srst_only
adapter srst pulse_width 100

# Use the FTDI layout from the working Nuclei config
ftdi layout_init 0x0008 0x001b
ftdi layout_signal nSRST -oe 0x0020 -data 0x0020

# --- Target Configuration ---
transport select jtag
set _CHIPNAME riscv
# Use the CORRECT JTAG ID for your chip
jtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0x1000563d
set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME riscv -chain-position $_TARGETNAME

# --- Work-area & Flash Driver ---
$_TARGETNAME configure -work-area-phys 0x20000000 -work-area-size 0x5000 -work-area-backup 0
set _FLASHNAME $_CHIPNAME.flash
# Revert to the stm32f1x driver, which is available with current OpenOCD(0.12).
flash bank $_FLASHNAME stm32f1x 0x08000000 0 0 0 $_TARGETNAME